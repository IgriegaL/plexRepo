name: Validar Documentación

on:
  push:
    branches: [ main ]
    paths:
      - '**.md'
  pull_request:
    branches: [ main ]
    paths:
      - '**.md'

jobs:
  markdown-lint:
    name: Lint Markdown
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout código
        uses: actions/checkout@v4
      
      - name: Lint archivos Markdown
        uses: nosborn/github-action-markdown-cli@v3.3.0
        with:
          files: .
          config_file: .markdownlint.json
          ignore_files: node_modules/
        continue-on-error: true
      
      - name: Verificar enlaces rotos
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          use-verbose-mode: 'yes'
          config-file: '.markdown-link-check.json'
        continue-on-error: true

  check-documentation:
    name: Verificar Documentación Completa
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout código
        uses: actions/checkout@v4
      
      - name: Verificar archivos de documentación requeridos
        run: |
          REQUIRED_DOCS=(
            "README.md"
            "GUIA_PRINCIPIANTES.md"
            "SECURITY.md"
            ".env.example"
          )
          
          for doc in "${REQUIRED_DOCS[@]}"; do
            if [ ! -f "$doc" ]; then
              echo "❌ ERROR: $doc no existe"
              exit 1
            fi
            echo "✅ $doc existe"
          done
      
      - name: Verificar que README tenga contenido mínimo
        run: |
          if [ $(wc -l < README.md) -lt 50 ]; then
            echo "❌ ERROR: README.md es muy corto"
            exit 1
          fi
          echo "✅ README.md tiene contenido suficiente"
      
      - name: Verificar enlaces internos
        run: |
          # Buscar enlaces a archivos que no existen
          grep -oP '\[.*?\]\(\K[^)]+' README.md | while read link; do
            # Ignorar URLs externas
            if [[ ! "$link" =~ ^http ]]; then
              # Remover anclas
              file=$(echo "$link" | cut -d'#' -f1)
              if [ -n "$file" ] && [ ! -f "$file" ]; then
                echo "⚠️ ADVERTENCIA: Enlace roto en README.md: $file"
              fi
            fi
          done

  spell-check:
    name: Revisar Ortografía
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout código
        uses: actions/checkout@v4
      
      - name: Spell check (Español)
        uses: rojopolis/spellcheck-github-actions@0.35.0
        with:
          config_path: .spellcheck.yml
        continue-on-error: true
