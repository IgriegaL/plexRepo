# Servicios Extras - Versión ARM64 Compatible
# Uso: docker compose -f docker-compose.yml -f docker-compose.extras-arm64.yml up -d

services:
  # ------------------- Fase 1: Críticos -------------------
  
  # Recyclarr - Auto-configuración de Calidad
  recyclarr:
    image: ghcr.io/recyclarr/recyclarr:latest
    container_name: recyclarr
    restart: unless-stopped
    user: ${PUID}:${PGID}
    environment:
      - TZ=${TZ}
    volumes:
      - ./recyclarr:/config
    networks:
      - media
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Uptime Kuma - Monitoreo Visual Simple
  uptime-kuma:
    image: louislam/uptime-kuma:latest
    container_name: uptime-kuma
    restart: unless-stopped
    volumes:
      - ./uptime-kuma:/app/data
    ports:
      - "3001:3001"
    networks:
      - monitoring
      - media
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001"]
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.uptime.rule=Host(`uptime.${DOMAIN}`)"
      - "traefik.http.routers.uptime.entrypoints=websecure"
      - "traefik.http.routers.uptime.tls.certresolver=letsencrypt"
      - "traefik.http.services.uptime.loadbalancer.server.port=3001"

  # ------------------- Fase 2: Muy Útiles -------------------
  
  # Nota: Requestrr y Autoscan no tienen soporte ARM64 confiable
  # Si los necesitas, considera alternativas o compilar desde fuente

  # ------------------- Fase 3: Mejoras Visuales -------------------
  
  # Kometa - Gestor de Colecciones y Metadata
  # Nota: Kometa tiene soporte ARM64 pero puede requerir más recursos
  kometa:
    image: kometateam/kometa:latest
    container_name: kometa
    restart: unless-stopped
    platform: linux/arm64
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - KOMETA_RUN=true
      - KOMETA_TIME=03:00
    volumes:
      - ./kometa:/config
    networks:
      - media
    depends_on:
      - plex
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Homepage - Dashboard Moderno
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ./homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock:ro
    ports:
      - "3002:3000"
    networks:
      - media
      - monitoring
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.homepage.rule=Host(`home.${DOMAIN}`)"
      - "traefik.http.routers.homepage.entrypoints=websecure"
      - "traefik.http.routers.homepage.tls.certresolver=letsencrypt"
      - "traefik.http.services.homepage.loadbalancer.server.port=3000"

  # ------------------- Fase 4: Mantenimiento -------------------
  
  # Maintainerr - Limpieza Automática
  # Nota: Maintainerr tiene soporte ARM64
  maintainerr:
    image: ghcr.io/jorenn92/maintainerr:latest
    container_name: maintainerr
    restart: unless-stopped
    platform: linux/arm64
    user: ${PUID}:${PGID}
    environment:
      - TZ=${TZ}
    volumes:
      - ./maintainerr:/opt/data
    ports:
      - "6246:6246"
    networks:
      - media
    depends_on:
      - plex
      - overseerr
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Nota: Scrutiny no está disponible para ARM64
  # Si necesitas monitoreo de discos en ARM64, considera alternativas como:
  # - smartmontools (línea de comandos)
  # - Netdata (incluye monitoreo de discos)

networks:
  media:
    name: plexrepo_media
    external: true
  monitoring:
    name: plexrepo_monitoring
    external: true
